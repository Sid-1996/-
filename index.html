<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨</title>
    <style>
        /* åœ¨é€™è£¡æ·»åŠ  CSS æ¨£å¼ */
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: white;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .title {
            text-align: center;
            color: navy;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .section {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .input-group {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
        }
        .input-group label {
            width: 80px;
            text-align: right;
            margin-right: 10px;
        }
        .input-group input {
            width: 80px;
            padding: 5px;
        }
        .button {
            padding: 8px 15px;
            margin-right: 10px;
            cursor: pointer;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .green { color: green; }
        .blue { color: blue; }
        .purple { color: purple; }
        .gold { color: gold; }
        .red { color: red; }
        .gray { color: gray; }
    </style>
</head>
<body>
    <div class="title">ğŸ® æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨ ğŸ®</div>
    
    <!-- ç›®æ¨™éœ€æ±‚è¨­å®šå€åŸŸ -->
    <div class="section">
        <div class="section-title">ç›®æ¨™éœ€æ±‚è¨­å®š</div>
        <div class="input-group">
            <label for="target-green">ç¶ è‰²ç´ æ:</label>
            <input type="number" id="target-green" value="31" min="0">
            <label for="target-blue">è—è‰²ç´ æ:</label>
            <input type="number" id="target-blue" value="36" min="0">
            <label for="target-purple">ç´«è‰²ç´ æ:</label>
            <input type="number" id="target-purple" value="61" min="0">
            <label for="target-gold">é‡‘è‰²ç´ æ:</label>
            <input type="number" id="target-gold" value="87" min="0">
        </div>
        <button class="button" id="set-target">è¨­å®š</button>
        <button class="button" id="reset-target">é‡ç½®</button>
    </div>
    
    <!-- ç•¶å‰æŒæœ‰æ•¸é‡ -->
    <div class="section">
        <div class="section-title">ç•¶å‰æŒæœ‰æ•¸é‡</div>
        <div class="input-group">
            <label for="current-green">ç¶ è‰²:</label>
            <input type="number" id="current-green" value="0" min="0">
            <label for="current-blue">è—è‰²:</label>
            <input type="number" id="current-blue" value="0" min="0">
            <label for="current-purple">ç´«è‰²:</label>
            <input type="number" id="current-purple" value="0" min="0">
            <label for="current-gold">é‡‘è‰²:</label>
            <input type="number" id="current-gold" value="0" min="0">
        </div>
    </div>
    
    <!-- ç•¶å‰ç‹€æ…‹åˆ†æ -->
    <div class="section">
        <div class="section-title">ç•¶å‰ç‹€æ…‹åˆ†æ</div>
        <table>
            <thead>
                <tr>
                    <th>é¡è‰²</th>
                    <th>ç›®æ¨™</th>
                    <th>æŒæœ‰</th>
                    <th>é‚„ç¼º</th>
                    <th>åŸºæœ¬éœ€æ±‚</th>
                    <th>å¯å‘ä¸Šåˆæˆ</th>
                    <th>æº¢å‡ºæ•¸é‡</th>
                </tr>
            </thead>
            <tbody id="status-analysis">
                <!-- é€™è£¡æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
        </table>
    </div>
    
    <!-- æ™ºæ…§åˆæˆå„ªåŒ–åˆ†æ -->
    <div class="section">
        <div class="section-title">ğŸ§  æ™ºæ…§æ¨¡æ“¬åˆæˆåˆ†æ(ä¿ç•™éœ€æ±‚æ•¸é‡ï¼Œå°‡æº¢å‡ºçš„å‘ä¸Šæ¨¡æ“¬åˆæˆ)</div>
        <table>
            <thead>
                <tr>
                    <th>é¡è‰²</th>
                    <th>æ¨¡æ“¬åˆæˆå¾Œæ•¸é‡</th>
                    <th>å¯¦éš›é‚„ç¼º</th>
                    <th>æ¨¡æ“¬åˆæˆæ¬¡æ•¸</th>
                    <th>æœ€çµ‚åˆ·å–å»ºè­°</th>
                </tr>
            </thead>
            <tbody id="optimized-analysis">
                <!-- é€™è£¡æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
            </tbody>
        </table>
    </div>
    
    <!-- æŒ‰éˆ•å€åŸŸ -->
    <div>
        <button class="button" id="reset">é‡ç½®</button>
        <button class="button" id="copy">è¤‡è£½å®Œæ•´åˆ†æ</button>
        <button class="button" id="calculate">é‡æ–°åˆ†æ</button>
        <button class="button" id="about">èªªæ˜</button>
    </div>
    
    <script>
        // é€™è£¡æ·»åŠ  JavaScript ä»£ç¢¼
        const config = {
            defaultRequirements: {
                green: 31,
                blue: 36,
                purple: 61,
                gold: 87
            },
            requirements: {
                green: 31,
                blue: 36,
                purple: 61,
                gold: 87
            },
            colors: {
                green: "ç¶ ",
                blue: "è—",
                purple: "ç´«",
                gold: "é‡‘"
            },
            colorOrder: ["green", "blue", "purple", "gold"]
        };
        
        // DOM å…ƒç´ 
        const elements = {
            targets: {
                green: document.getElementById("target-green"),
                blue: document.getElementById("target-blue"),
                purple: document.getElementById("target-purple"),
                gold: document.getElementById("target-gold")
            },
            currents: {
                green: document.getElementById("current-green"),
                blue: document.getElementById("current-blue"),
                purple: document.getElementById("current-purple"),
                gold: document.getElementById("current-gold")
            },
            statusTable: document.getElementById("status-analysis"),
            optimizedTable: document.getElementById("optimized-analysis"),
            buttons: {
                setTarget: document.getElementById("set-target"),
                resetTarget: document.getElementById("reset-target"),
                reset: document.getElementById("reset"),
                copy: document.getElementById("copy"),
                calculate: document.getElementById("calculate"),
                about: document.getElementById("about")
            }
        };
        
        // åˆå§‹åŒ–
        function init() {
            // ç¶å®šäº‹ä»¶
            elements.buttons.setTarget.addEventListener("click", setTargetRequirements);
            elements.buttons.resetTarget.addEventListener("click", resetTargetToDefault);
            elements.buttons.reset.addEventListener("click", resetAll);
            elements.buttons.copy.addEventListener("click", copyResults);
            elements.buttons.calculate.addEventListener("click", updateCalculation);
            elements.buttons.about.addEventListener("click", showAbout);
            
            // ç¶å®šè¼¸å…¥è®ŠåŒ–äº‹ä»¶
            for (const color of config.colorOrder) {
                elements.currents[color].addEventListener("change", updateCalculation);
            }
            
            // åˆå§‹è¨ˆç®—
            updateCalculation();
        }
        
        // è¨­å®šç›®æ¨™éœ€æ±‚
        function setTargetRequirements() {
            for (const color of config.colorOrder) {
                const value = parseInt(elements.targets[color].value) || 0;
                config.requirements[color] = value;
            }
            updateCalculation();
        }
        
        // é‡ç½®ç›®æ¨™éœ€æ±‚
        function resetTargetToDefault() {
            for (const color of config.colorOrder) {
                config.requirements[color] = config.defaultRequirements[color];
                elements.targets[color].value = config.defaultRequirements[color];
            }
            updateCalculation();
        }
        
        // é‡ç½®æ‰€æœ‰
        function resetAll() {
            for (const color of config.colorOrder) {
                elements.currents[color].value = 0;
            }
            updateCalculation();
        }
        
        // æ›´æ–°è¨ˆç®—
        function updateCalculation() {
            const current = {};
            for (const color of config.colorOrder) {
                current[color] = parseInt(elements.currents[color].value) || 0;
            }
            
            updateCurrentStatus(current);
            performSmartOptimization(current);
        }
        
        // æ›´æ–°ç•¶å‰ç‹€æ…‹
        function updateCurrentStatus(current) {
            let html = "";
            
            for (const color of config.colorOrder) {
                const need = config.requirements[color];
                const have = current[color];
                const missing = Math.max(0, need - have);
                const excess = Math.max(0, have - need);
                const canMake = color !== "gold" ? Math.floor(have / 3) : 0;
                
                html += `
                <tr>
                    <td class="${color}">${getColorIcon(color)}${config.colors[color]}</td>
                    <td>${need}</td>
                    <td>${have}</td>
                    <td class="${missing > 0 ? "red" : "green"}">${missing}</td>
                    <td class="${missing > 0 ? "red" : "green"}">${
                        missing > 0 ? `éœ€è¦åˆ· ${missing} å€‹` : "âœ“ è¶³å¤ "
                    }</td>
                    <td class="${canMake > 0 ? "blue" : "gray"}">${
                        color !== "gold" 
                            ? (canMake > 0 ? `å¯åˆæˆ ${canMake} æ¬¡` : "ç„¡æ³•åˆæˆ")
                            : "æœ€é«˜ç­‰ç´š"
                    }</td>
                    <td class="${excess > 0 ? "red" : "gray"}">${
                        excess > 0 ? `æº¢å‡º ${excess}` : "0"
                    }</td>
                </tr>`;
            }
            
            elements.statusTable.innerHTML = html;
        }
        
        // åŸ·è¡Œæ™ºæ…§å„ªåŒ–
        function performSmartOptimization(current) {
            const optimized = {...current};
            const synthPath = {};
            const synthTimes = {}; // è¨˜éŒ„æ¯ç¨®é¡è‰²çš„åˆæˆæ¬¡æ•¸
            
            // å¾ç¶ è‰²é–‹å§‹å‘ä¸Šåˆæˆå„ªåŒ–
            for (let i = 0; i < config.colorOrder.length - 1; i++) {
                const color = config.colorOrder[i];
                const nextColor = config.colorOrder[i + 1];
                const need = config.requirements[color];
                const have = optimized[color];
                
                if (have > need) {
                    const excess = have - need;
                    const times = Math.floor(excess / 3);
                    
                    if (times > 0) {
                        optimized[color] -= times * 3;
                        optimized[nextColor] += times;
                        synthPath[color] = `åˆæˆ${times}æ¬¡â†’${config.colors[nextColor]}`;
                        synthTimes[color] = times;
                    } else {
                        synthTimes[color] = 0;
                    }
                } else {
                    synthTimes[color] = 0;
                }
            }
            
            // é‡‘è‰²æ²’æœ‰åˆæˆé¸é …
            synthTimes["gold"] = 0;
            
            // æ›´æ–°å„ªåŒ–çµæœé¡¯ç¤º
            let html = "";
            
            for (const color of config.colorOrder) {
                const need = config.requirements[color];
                const optimizedAmount = optimized[color];
                const realNeed = Math.max(0, need - optimizedAmount);
                const times = synthTimes[color] || 0;
                
                let advice = "";
                if (realNeed > 0) {
                    advice = `ğŸ¯ é‚„éœ€åˆ·å– ${realNeed} å€‹`;
                } else if (optimizedAmount > need) {
                    const surplus = optimizedAmount - need;
                    advice = `âœ… é”æ¨™ (å¤šå‡º ${surplus} å€‹)`;
                } else {
                    advice = "âœ… å‰›å¥½é”æ¨™";
                }
                
                html += `
                <tr>
                    <td class="${color}">${getColorIcon(color)}${config.colors[color]}</td>
                    <td class="${optimizedAmount >= need ? "green" : "red"}">${optimizedAmount}</td>
                    <td class="${realNeed > 0 ? "red" : "green"}">${realNeed}</td>
                    <td class="${times > 0 ? "blue" : "gray"}">${times > 0 ? `${times} æ¬¡` : "ç„¡åˆæˆ"}</td>
                    <td class="${realNeed > 0 ? "red" : "green"}">${advice}</td>
                </tr>`;
            }
            
            elements.optimizedTable.innerHTML = html;
        }
        
        // ç²å–é¡è‰²åœ–æ¨™
        function getColorIcon(color) {
            const icons = {
                green: "ğŸŸ¢",
                blue: "ğŸ”µ",
                purple: "ğŸŸ£",
                gold: "ğŸŸ¡"
            };
            return icons[color] || "";
        }
        
        // è¤‡è£½çµæœ
        function copyResults() {
            const current = {};
            const optimized = {};
            const synthTimes = {};
            
            // ç²å–ç•¶å‰æ•¸æ“š
            for (const color of config.colorOrder) {
                current[color] = parseInt(elements.currents[color].value) || 0;
                optimized[color] = current[color];
            }
            
            // æ¨¡æ“¬åˆæˆéç¨‹
            for (let i = 0; i < config.colorOrder.length - 1; i++) {
                const color = config.colorOrder[i];
                const nextColor = config.colorOrder[i + 1];
                const need = config.requirements[color];
                const have = optimized[color];
                
                if (have > need) {
                    const excess = have - need;
                    const times = Math.floor(excess / 3);
                    
                    if (times > 0) {
                        optimized[color] -= times * 3;
                        optimized[nextColor] += times;
                        synthTimes[color] = times;
                    } else {
                        synthTimes[color] = 0;
                    }
                } else {
                    synthTimes[color] = 0;
                }
            }
            synthTimes["gold"] = 0;
            
            let result = "=== æ™ºæ…§ç´ æéœ€æ±‚åˆ†æå ±å‘Š ===\n\n";
            result += "ğŸ“… ç”Ÿæˆæ™‚é–“: " + new Date().toLocaleString() + "\n\n";
            
            // 1. ç›®æ¨™éœ€æ±‚
            result += "ğŸ¯ ç›®æ¨™éœ€æ±‚:\n";
            for (const color of config.colorOrder) {
                result += `- ${config.colors[color]}è‰²: ${config.requirements[color]} å€‹\n`;
            }
            
            // 2. ç•¶å‰æŒæœ‰
            result += "\nğŸ“¦ ç•¶å‰æŒæœ‰:\n";
            for (const color of config.colorOrder) {
                result += `- ${config.colors[color]}è‰²: ${current[color]} å€‹\n`;
            }
            
            // 3. æ¨¡æ“¬åˆæˆåˆ†æ
            result += "\nğŸ§  æ¨¡æ“¬åˆæˆåˆ†æ:\n";
            for (const color of config.colorOrder) {
                if (color !== "gold" && synthTimes[color] > 0) {
                    const nextColor = config.colorOrder[config.colorOrder.indexOf(color) + 1];
                    result += `- å°‡ ${config.colors[color]}è‰²åˆæˆ ${synthTimes[color]} æ¬¡ â†’ ç²å¾— ${synthTimes[color]} å€‹${config.colors[nextColor]}è‰²\n`;
                }
            }
            
            // 4. æ¨¡æ“¬å¾Œæ•¸é‡
            result += "\nğŸ”„ æ¨¡æ“¬åˆæˆå¾Œæ•¸é‡:\n";
            for (const color of config.colorOrder) {
                const need = config.requirements[color];
                const after = optimized[color];
                const status = after >= need ? "âœ“ é”æ¨™" : "âœ— ä¸è¶³";
                result += `- ${config.colors[color]}è‰²: ${after} å€‹ (${status})\n`;
            }
            
            // 5. æœ€çµ‚åˆ·å–å»ºè­°
            result += "\nğŸ’¡ æœ€çµ‚åˆ·å–å»ºè­°:\n";
            let totalNeed = 0;
            let hasNeed = false;
            
            for (const color of config.colorOrder) {
                const need = config.requirements[color];
                const after = optimized[color];
                const missing = Math.max(0, need - after);
                
                if (missing > 0) {
                    hasNeed = true;
                    totalNeed += missing;
                    result += `- é‚„éœ€åˆ·å– ${config.colors[color]}è‰²: ${missing} å€‹\n`;
                }
            }
            
            if (!hasNeed) {
                result += "- æ‰€æœ‰ç´ æéƒ½å·²é”æ¨™ï¼Œç„¡éœ€é¡å¤–åˆ·å–ï¼\n";
            } else {
                result += `\nç¸½è¨ˆéœ€è¦åˆ·å–: ${totalNeed} å€‹ç´ æ\n`;
            }
            
            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(result)
                .then(() => alert("æ¨¡æ“¬åˆæˆåˆ†æå ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼"))
                .catch(err => {
                    console.error("è¤‡è£½å¤±æ•—:", err);
                    // é™ç´šæ–¹æ¡ˆ
                    const textarea = document.createElement("textarea");
                    textarea.value = result;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textarea);
                    alert("åˆ†æå ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
                });
        }
        
        // é¡¯ç¤ºèªªæ˜
        function showAbout() {
            const about = `ğŸ® æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨ v2.2\n\n
âœ¨ åŠŸèƒ½ç‰¹è‰²:\n
â€¢ å¯è‡ªè¨‚å„è‰²ç´ æçš„ç›®æ¨™éœ€æ±‚æ•¸é‡\n
â€¢ æ™ºæ…§æ¨¡æ“¬åˆæˆç³»çµ±ï¼Œè‡ªå‹•è¨ˆç®—æœ€ä½³åˆæˆç­–ç•¥\n
â€¢ è©³ç´°åˆ†ææ¨¡æ“¬åˆæˆå¾Œçš„ç´ ææ•¸é‡è®ŠåŒ–\n
â€¢ æä¾›ç²¾ç¢ºçš„æœ€çµ‚åˆ·å–å»ºè­°\n\n
ğŸ“‹ ä½¿ç”¨èªªæ˜:\n
1. åœ¨ã€Œç›®æ¨™éœ€æ±‚è¨­å®šã€è¨­å®šæ‚¨éœ€è¦çš„å„è‰²ç´ ææ•¸é‡\n
2. åœ¨ã€Œç•¶å‰æŒæœ‰æ•¸é‡ã€è¼¸å…¥æ‚¨ç›®å‰æ“æœ‰çš„ç´ æ\n
3. æŸ¥çœ‹ã€Œæ™ºæ…§æ¨¡æ“¬åˆæˆåˆ†æã€äº†è§£ç³»çµ±å»ºè­°çš„åˆæˆç­–ç•¥\n
4. æŒ‰ç…§ã€Œæœ€çµ‚åˆ·å–å»ºè­°ã€é€²è¡Œç´ ææ”¶é›†\n\n
ğŸ”„ æ¨¡æ“¬åˆæˆè¦å‰‡:\n
â€¢ æ¯3å€‹ä½éšç´ æå¯åˆæˆ1å€‹é«˜éšç´ æ\n
â€¢ ç³»çµ±æœƒè‡ªå‹•ä¿ç•™æ‚¨è¨­å®šçš„ç›®æ¨™æ•¸é‡\n
â€¢ åªæœƒå°‡è¶…å‡ºéƒ¨åˆ†çš„ç´ æç”¨æ–¼åˆæˆ\n\n
ğŸ¨ é¡è‰²æ¨™ç¤º:\n
ğŸŸ¢ ç¶ è‰²: å·²é”æ¨™æˆ–è¶³å¤ \n
ğŸ”´ ç´…è‰²: ä¸è¶³æˆ–éœ€è¦æ³¨æ„\n
ğŸ”µ è—è‰²: åˆæˆç›¸é—œæ“ä½œ\n
âšª ç°è‰²: ç„¡éœ€æ“ä½œ`;
            
            alert(about);
        }
        
        // å•Ÿå‹•æ‡‰ç”¨
        init();
    </script>
</body>
</html>
