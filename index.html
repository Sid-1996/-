<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .title {
            text-align: center;
            color: #2c3e50;
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .section {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .section-title {
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .input-group label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        
        .input-group input {
            width: 80px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 1.1em;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
        }
        
        .button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            font-weight: bold;
            font-size: 1em;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e8f4f8;
            transition: background-color 0.3s ease;
        }
        
        .green { color: #27ae60; font-weight: bold; }
        .blue { color: #3498db; font-weight: bold; }
        .purple { color: #9b59b6; font-weight: bold; }
        .gold { color: #f39c12; font-weight: bold; }
        .red { color: #e74c3c; font-weight: bold; }
        .gray { color: #7f8c8d; }
        
        .highlight-box {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            border: 2px solid #fdcb6e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .strategy-box {
            background: linear-gradient(45deg, #d4edda, #a8e6cf);
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .button-group {
            text-align: center;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .input-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸ® æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨ ğŸ®</div>
        
        <!-- ç›®æ¨™éœ€æ±‚è¨­å®šå€åŸŸ -->
        <div class="section">
            <div class="section-title">ğŸ¯ ç›®æ¨™éœ€æ±‚è¨­å®š</div>
            <div class="input-grid">
                <div class="input-group">
                    <label for="target-green" class="green">ğŸŸ¢ ç¶ è‰²ç´ æ</label>
                    <input type="number" id="target-green" value="31" min="0">
                </div>
                <div class="input-group">
                    <label for="target-blue" class="blue">ğŸ”µ è—è‰²ç´ æ</label>
                    <input type="number" id="target-blue" value="36" min="0">
                </div>
                <div class="input-group">
                    <label for="target-purple" class="purple">ğŸŸ£ ç´«è‰²ç´ æ</label>
                    <input type="number" id="target-purple" value="61" min="0">
                </div>
                <div class="input-group">
                    <label for="target-gold" class="gold">ğŸŸ¡ é‡‘è‰²ç´ æ</label>
                    <input type="number" id="target-gold" value="87" min="0">
                </div>
            </div>
            <div class="button-group">
                <button class="button btn-primary" id="set-target">è¨­å®šç›®æ¨™</button>
                <button class="button btn-secondary" id="reset-target">é‡ç½®é è¨­</button>
            </div>
        </div>
        
        <!-- ç•¶å‰æŒæœ‰æ•¸é‡ -->
        <div class="section">
            <div class="section-title">ğŸ“¦ ç•¶å‰æŒæœ‰æ•¸é‡</div>
            <div class="input-grid">
                <div class="input-group">
                    <label for="current-green" class="green">ğŸŸ¢ ç¶ è‰²</label>
                    <input type="number" id="current-green" value="407" min="0">
                </div>
                <div class="input-group">
                    <label for="current-blue" class="blue">ğŸ”µ è—è‰²</label>
                    <input type="number" id="current-blue" value="625" min="0">
                </div>
                <div class="input-group">
                    <label for="current-purple" class="purple">ğŸŸ£ ç´«è‰²</label>
                    <input type="number" id="current-purple" value="107" min="0">
                </div>
                <div class="input-group">
                    <label for="current-gold" class="gold">ğŸŸ¡ é‡‘è‰²</label>
                    <input type="number" id="current-gold" value="10" min="0">
                </div>
            </div>
        </div>
        
        <!-- é€†å‘è¨ˆç®—ç­–ç•¥ -->
        <div class="section">
            <div class="section-title">ğŸ§  é€†å‘è¨ˆç®—æœ€ä½³ç­–ç•¥</div>
            <div class="strategy-box">
                <div id="reverse-strategy"></div>
            </div>
        </div>
        
        <!-- ç•¶å‰ç‹€æ…‹åˆ†æ -->
        <div class="section">
            <div class="section-title">ğŸ“Š ç•¶å‰ç‹€æ…‹åˆ†æ</div>
            <table>
                <thead>
                    <tr>
                        <th>é¡è‰²</th>
                        <th>ç›®æ¨™</th>
                        <th>æŒæœ‰</th>
                        <th>ç¼ºå°‘/å¤šé¤˜</th>
                        <th>å¯åˆæˆæ¬¡æ•¸</th>
                        <th>å»ºè­°æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="status-analysis">
                    <!-- é€™è£¡æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>
        
        <!-- æ¨¡æ“¬åŸ·è¡Œçµæœ -->
        <div class="section">
            <div class="section-title">ğŸ”„ æ¨¡æ“¬åŸ·è¡Œçµæœ</div>
            <div class="highlight-box">
                <div id="simulation-result"></div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>é¡è‰²</th>
                        <th>åŸ·è¡Œå‰</th>
                        <th>åˆæˆæ“ä½œ</th>
                        <th>åŸ·è¡Œå¾Œ</th>
                        <th>èˆ‡ç›®æ¨™æ¯”è¼ƒ</th>
                    </tr>
                </thead>
                <tbody id="simulation-table">
                </tbody>
            </table>
        </div>
        
        <!-- æŒ‰éˆ•å€åŸŸ -->
        <div class="button-group">
            <button class="button btn-secondary" id="reset">é‡ç½®æ•¸æ“š</button>
            <button class="button btn-success" id="copy">è¤‡è£½åˆ†æå ±å‘Š</button>
            <button class="button btn-primary" id="calculate">é‡æ–°è¨ˆç®—</button>
            <button class="button btn-warning" id="about">ä½¿ç”¨èªªæ˜</button>
        </div>
    </div>
    
    <script>
        const config = {
            defaultRequirements: { green: 31, blue: 36, purple: 61, gold: 87 },
            requirements: { green: 31, blue: 36, purple: 61, gold: 87 },
            colors: { green: "ç¶ ", blue: "è—", purple: "ç´«", gold: "é‡‘" },
            colorOrder: ["green", "blue", "purple", "gold"],
            icons: { green: "ğŸŸ¢", blue: "ğŸ”µ", purple: "ğŸŸ£", gold: "ğŸŸ¡" }
        };
        
        const elements = {
            targets: {
                green: document.getElementById("target-green"),
                blue: document.getElementById("target-blue"),
                purple: document.getElementById("target-purple"),
                gold: document.getElementById("target-gold")
            },
            currents: {
                green: document.getElementById("current-green"),
                blue: document.getElementById("current-blue"),
                purple: document.getElementById("current-purple"),
                gold: document.getElementById("current-gold")
            },
            reverseStrategy: document.getElementById("reverse-strategy"),
            statusTable: document.getElementById("status-analysis"),
            simulationResult: document.getElementById("simulation-result"),
            simulationTable: document.getElementById("simulation-table"),
            buttons: {
                setTarget: document.getElementById("set-target"),
                resetTarget: document.getElementById("reset-target"),
                reset: document.getElementById("reset"),
                copy: document.getElementById("copy"),
                calculate: document.getElementById("calculate"),
                about: document.getElementById("about")
            }
        };
        
        function init() {
            elements.buttons.setTarget.addEventListener("click", setTargetRequirements);
            elements.buttons.resetTarget.addEventListener("click", resetTargetToDefault);
            elements.buttons.reset.addEventListener("click", resetAll);
            elements.buttons.copy.addEventListener("click", copyResults);
            elements.buttons.calculate.addEventListener("click", updateCalculation);
            elements.buttons.about.addEventListener("click", showAbout);
            
            for (const color of config.colorOrder) {
                elements.currents[color].addEventListener("input", updateCalculation);
                elements.targets[color].addEventListener("input", () => {
                    setTargetRequirements();
                    updateCalculation();
                });
            }
            
            updateCalculation();
        }
        
        function setTargetRequirements() {
            for (const color of config.colorOrder) {
                const value = parseInt(elements.targets[color].value) || 0;
                config.requirements[color] = value;
            }
        }
        
        function resetTargetToDefault() {
            for (const color of config.colorOrder) {
                config.requirements[color] = config.defaultRequirements[color];
                elements.targets[color].value = config.defaultRequirements[color];
            }
            updateCalculation();
        }
        
        function resetAll() {
            for (const color of config.colorOrder) {
                elements.currents[color].value = 0;
            }
            updateCalculation();
        }
        
        // é€†å‘è¨ˆç®—æœ€ä½³ç­–ç•¥
        function calculateReverseStrategy() {
            const targets = config.requirements;
            
            // å¾é‡‘è‰²é–‹å§‹é€†å‘è¨ˆç®—å¯¦éš›éœ€è¦çš„å„è‰²ç´ ææ•¸é‡
            let actualNeed = {
                gold: targets.gold,
                purple: targets.purple,
                blue: targets.blue,
                green: targets.green
            };
            
            // é€†å‘è¨ˆç®—ï¼šå¦‚æœé‡‘è‰²ä¸è¶³ï¼Œéœ€è¦å¤šå°‘ç´«è‰²ä¾†åˆæˆ
            if (actualNeed.gold > 0) {
                actualNeed.purple = Math.max(actualNeed.purple, Math.ceil(actualNeed.gold / 1) * 3);
            }
            
            // å¦‚æœç´«è‰²ä¸è¶³ï¼Œéœ€è¦å¤šå°‘è—è‰²ä¾†åˆæˆ
            const purpleFromBlue = Math.max(0, actualNeed.purple - targets.purple);
            if (purpleFromBlue > 0) {
                actualNeed.blue = Math.max(actualNeed.blue, targets.blue + Math.ceil(purpleFromBlue / 1) * 3);
            }
            
            // å¦‚æœè—è‰²ä¸è¶³ï¼Œéœ€è¦å¤šå°‘ç¶ è‰²ä¾†åˆæˆ
            const blueFromGreen = Math.max(0, actualNeed.blue - targets.blue);
            if (blueFromGreen > 0) {
                actualNeed.green = Math.max(actualNeed.green, targets.green + Math.ceil(blueFromGreen / 1) * 3);
            }
            
            return actualNeed;
        }
        
        // è¨ˆç®—æœ€å„ªåˆæˆç­–ç•¥ - ç²¾ç¢ºé”æ¨™ç‰ˆæœ¬
        function calculateOptimalStrategy(current) {
            const targets = config.requirements;
            let strategy = {
                synthesize: { green: 0, blue: 0, purple: 0 },
                final: { ...current },
                waste: { green: 0, blue: 0, purple: 0, gold: 0 }
            };
            
            // è¤‡è£½ç•¶å‰æ•¸é‡é€²è¡Œæ¨¡æ“¬
            let workingAmounts = { ...current };
            
            // é€†å‘è¨ˆç®—ï¼šå¾é‡‘è‰²é–‹å§‹ï¼Œè¨ˆç®—å‰›å¥½éœ€è¦å¤šå°‘åˆæˆ
            // ç¬¬ä¸€æ­¥ï¼šè¨ˆç®—é‡‘è‰²ç¼ºå£
            let goldDeficit = Math.max(0, targets.gold - workingAmounts.gold);
            
            if (goldDeficit > 0) {
                // éœ€è¦åˆæˆé‡‘è‰²
                let purpleNeededForGold = goldDeficit * 3;
                
                // æª¢æŸ¥ç´«è‰²æ˜¯å¦è¶³å¤ 
                let availablePurpleForGold = Math.max(0, workingAmounts.purple - targets.purple);
                let purpleMade = Math.min(purpleNeededForGold, availablePurpleForGold);
                let goldMade = Math.floor(purpleMade / 3);
                
                if (goldMade > 0) {
                    strategy.synthesize.purple = goldMade;
                    workingAmounts.purple -= goldMade * 3;
                    workingAmounts.gold += goldMade;
                    goldDeficit -= goldMade;
                }
                
                // å¦‚æœé‡‘è‰²é‚„ä¸å¤ ï¼Œéœ€è¦ç”¨è—è‰²åˆæˆç´«è‰²
                if (goldDeficit > 0) {
                    let morePurpleNeeded = goldDeficit * 3;
                    let availableBlueForPurple = Math.max(0, workingAmounts.blue - targets.blue);
                    let blueMadeIntoPurple = Math.min(morePurpleNeeded * 3, availableBlueForPurple);
                    let purpleMadeFromBlue = Math.floor(blueMadeIntoPurple / 3);
                    
                    if (purpleMadeFromBlue > 0) {
                        strategy.synthesize.blue += purpleMadeFromBlue;
                        workingAmounts.blue -= purpleMadeFromBlue * 3;
                        workingAmounts.purple += purpleMadeFromBlue;
                        
                        // ç¾åœ¨ç”¨æ–°å¾—åˆ°çš„ç´«è‰²åˆæˆé‡‘è‰²
                        let newGoldMade = Math.min(purpleMadeFromBlue, goldDeficit);
                        if (newGoldMade > 0) {
                            strategy.synthesize.purple += newGoldMade;
                            workingAmounts.purple -= newGoldMade * 3;
                            workingAmounts.gold += newGoldMade;
                            goldDeficit -= newGoldMade;
                        }
                    }
                }
                
                // å¦‚æœé‚„ä¸å¤ ï¼Œéœ€è¦ç”¨ç¶ è‰²åˆæˆ
                if (goldDeficit > 0) {
                    let morePurpleNeeded = goldDeficit * 3;
                    let moreBlueNeeded = morePurpleNeeded * 3;
                    let availableGreenForBlue = Math.max(0, workingAmounts.green - targets.green);
                    let greenMadeIntoBlue = Math.min(moreBlueNeeded * 3, availableGreenForBlue);
                    let blueMadeFromGreen = Math.floor(greenMadeIntoBlue / 3);
                    
                    if (blueMadeFromGreen > 0) {
                        strategy.synthesize.green += blueMadeFromGreen;
                        workingAmounts.green -= blueMadeFromGreen * 3;
                        workingAmounts.blue += blueMadeFromGreen;
                        
                        // ç¹¼çºŒåˆæˆéˆ
                        let purpleMadeFromNewBlue = Math.floor(blueMadeFromGreen / 3);
                        if (purpleMadeFromNewBlue > 0) {
                            strategy.synthesize.blue += purpleMadeFromNewBlue;
                            workingAmounts.blue -= purpleMadeFromNewBlue * 3;
                            workingAmounts.purple += purpleMadeFromNewBlue;
                            
                            let goldMadeFromNewPurple = Math.min(purpleMadeFromNewBlue, goldDeficit);
                            if (goldMadeFromNewPurple > 0) {
                                strategy.synthesize.purple += goldMadeFromNewPurple;
                                workingAmounts.purple -= goldMadeFromNewPurple * 3;
                                workingAmounts.gold += goldMadeFromNewPurple;
                            }
                        }
                    }
                }
            }
            
            // ç¬¬äºŒæ­¥ï¼šè™•ç†ç´«è‰²ç¼ºå£ï¼ˆå¦‚æœæœ‰ï¼‰
            let purpleDeficit = Math.max(0, targets.purple - workingAmounts.purple);
            if (purpleDeficit > 0) {
                let availableBlue = Math.max(0, workingAmounts.blue - targets.blue);
                let blueNeeded = purpleDeficit * 3;
                let blueToUse = Math.min(blueNeeded, availableBlue);
                let purpleMade = Math.floor(blueToUse / 3);
                
                if (purpleMade > 0) {
                    strategy.synthesize.blue += purpleMade;
                    workingAmounts.blue -= purpleMade * 3;
                    workingAmounts.purple += purpleMade;
                    purpleDeficit -= purpleMade;
                }
                
                // å¦‚æœé‚„ä¸å¤ ï¼Œç”¨ç¶ è‰²
                if (purpleDeficit > 0) {
                    let moreBlueNeeded = purpleDeficit * 3;
                    let availableGreen = Math.max(0, workingAmounts.green - targets.green);
                    let greenNeeded = moreBlueNeeded * 3;
                    let greenToUse = Math.min(greenNeeded, availableGreen);
                    let blueMadeFromGreen = Math.floor(greenToUse / 3);
                    
                    if (blueMadeFromGreen > 0) {
                        strategy.synthesize.green += blueMadeFromGreen;
                        workingAmounts.green -= blueMadeFromGreen * 3;
                        workingAmounts.blue += blueMadeFromGreen;
                        
                        let morePurpleMade = Math.floor(blueMadeFromGreen / 3);
                        if (morePurpleMade > 0) {
                            strategy.synthesize.blue += morePurpleMade;
                            workingAmounts.blue -= morePurpleMade * 3;
                            workingAmounts.purple += morePurpleMade;
                        }
                    }
                }
            }
            
            // ç¬¬ä¸‰æ­¥ï¼šè™•ç†è—è‰²ç¼ºå£ï¼ˆå¦‚æœæœ‰ï¼‰
            let blueDeficit = Math.max(0, targets.blue - workingAmounts.blue);
            if (blueDeficit > 0) {
                let availableGreen = Math.max(0, workingAmounts.green - targets.green);
                let greenNeeded = blueDeficit * 3;
                let greenToUse = Math.min(greenNeeded, availableGreen);
                let blueMade = Math.floor(greenToUse / 3);
                
                if (blueMade > 0) {
                    strategy.synthesize.green += blueMade;
                    workingAmounts.green -= blueMade * 3;
                    workingAmounts.blue += blueMade;
                }
            }
            
            strategy.final = workingAmounts;
            
            // è¨ˆç®—å‰©é¤˜
            for (const color of config.colorOrder) {
                strategy.waste[color] = Math.max(0, workingAmounts[color] - targets[color]);
            }
            
            return strategy;
        }
        
        function updateCalculation() {
            const current = {};
            for (const color of config.colorOrder) {
                current[color] = parseInt(elements.currents[color].value) || 0;
            }
            
            updateReverseStrategy();
            updateCurrentStatus(current);
            updateSimulation(current);
        }
        
        function updateReverseStrategy() {
            const actualNeed = calculateReverseStrategy();
            const current = {};
            
            for (const color of config.colorOrder) {
                current[color] = parseInt(elements.currents[color].value) || 0;
            }
            
            let html = "<h3>ğŸ¯ é€†å‘åˆ†æçµæœï¼š</h3>";
            html += "<div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;'>";
            
            for (const color of config.colorOrder) {
                const need = actualNeed[color];
                const have = current[color];
                const status = have >= need ? "âœ…" : "âŒ";
                const diff = have - need;
                
                html += `
                <div style='background: ${color === "green" ? "#e8f5e8" : color === "blue" ? "#e8f4fd" : color === "purple" ? "#f4e8fd" : "#fff8e8"}; 
                           padding: 10px; border-radius: 8px; text-align: center;'>
                    <div class="${color}">${config.icons[color]} ${config.colors[color]}è‰²</div>
                    <div>å¯¦éš›éœ€æ±‚: <strong>${need}</strong></div>
                    <div>ç•¶å‰æŒæœ‰: <strong>${have}</strong></div>
                    <div>${status} ${diff >= 0 ? `å¤šå‡º ${diff}` : `ç¼ºå°‘ ${Math.abs(diff)}`}</div>
                </div>`;
            }
            html += "</div>";
            
            elements.reverseStrategy.innerHTML = html;
        }
        
        function updateCurrentStatus(current) {
            let html = "";
            
            for (const color of config.colorOrder) {
                const need = config.requirements[color];
                const have = current[color];
                const diff = have - need;
                const canMake = color !== "gold" ? Math.floor(have / 3) : 0;
                
                let advice = "";
                if (diff >= 0) {
                    advice = diff === 0 ? "å‰›å¥½é”æ¨™" : `å¤šå‡º ${diff} å€‹`;
                } else {
                    advice = `ç¼ºå°‘ ${Math.abs(diff)} å€‹`;
                }
                
                let synthesizeInfo = "";
                if (color !== "gold") {
                    synthesizeInfo = canMake > 0 ? `å¯åˆæˆ ${canMake} æ¬¡` : "ç„¡æ³•åˆæˆ";
                } else {
                    synthesizeInfo = "æœ€é«˜ç­‰ç´š";
                }
                
                html += `
                <tr>
                    <td class="${color}">${config.icons[color]} ${config.colors[color]}è‰²</td>
                    <td>${need}</td>
                    <td>${have}</td>
                    <td class="${diff >= 0 ? "green" : "red"}">${advice}</td>
                    <td class="${canMake > 0 ? "blue" : "gray"}">${synthesizeInfo}</td>
                    <td class="${diff >= 0 ? "green" : "red"}">${diff >= 0 ? "âœ… è¶³å¤ " : "âŒ éœ€è¦åˆ·å–"}</td>
                </tr>`;
            }
            
            elements.statusTable.innerHTML = html;
        }
        
        function updateSimulation(current) {
            const strategy = calculateOptimalStrategy(current);
            
            // æ›´æ–°æ¨¡æ“¬çµæœèªªæ˜
            let resultHtml = "<h3>ğŸ” åŸ·è¡Œç­–ç•¥ï¼š</h3><ul>";
            
            if (strategy.synthesize.green > 0) {
                resultHtml += `<li>ğŸŸ¢â†’ğŸ”µ å°‡ ${strategy.synthesize.green * 3} å€‹ç¶ è‰²åˆæˆç‚º ${strategy.synthesize.green} å€‹è—è‰²</li>`;
            }
            if (strategy.synthesize.blue > 0) {
                resultHtml += `<li>ğŸ”µâ†’ğŸŸ£ å°‡ ${strategy.synthesize.blue * 3} å€‹è—è‰²åˆæˆç‚º ${strategy.synthesize.blue} å€‹ç´«è‰²</li>`;
            }
            if (strategy.synthesize.purple > 0) {
                resultHtml += `<li>ğŸŸ£â†’ğŸŸ¡ å°‡ ${strategy.synthesize.purple * 3} å€‹ç´«è‰²åˆæˆç‚º ${strategy.synthesize.purple} å€‹é‡‘è‰²</li>`;
            }
            
            if (strategy.synthesize.green === 0 && strategy.synthesize.blue === 0 && strategy.synthesize.purple === 0) {
                resultHtml += "<li>âœ¨ ç„¡éœ€åˆæˆï¼Œç•¶å‰è³‡æºå·²ç¶“æœ€å„ªé…ç½®</li>";
            }
            
            resultHtml += "</ul>";
            
            // æª¢æŸ¥æ˜¯å¦é‚„æœ‰ä¸è¶³
            let missingHtml = "<h3>ğŸ“‹ æœ€çµ‚ç‹€æ…‹ï¼š</h3><ul>";
            let totalMissing = 0;
            let allSatisfied = true;
            
            for (const color of config.colorOrder) {
                const final = strategy.final[color];
                const target = config.requirements[color];
                const missing = Math.max(0, target - final);
                
                if (missing > 0) {
                    missingHtml += `<li class="red">âŒ ${config.colors[color]}è‰²é‚„éœ€è¦ ${missing} å€‹</li>`;
                    totalMissing += missing;
                    allSatisfied = false;
                } else {
                    const surplus = final - target;
                    if (surplus > 0) {
                        missingHtml += `<li class="green">âœ… ${config.colors[color]}è‰²é”æ¨™ (å¤šå‡º ${surplus} å€‹)</li>`;
                    } else {
                        missingHtml += `<li class="green">âœ… ${config.colors[color]}è‰²å®Œç¾é”æ¨™</li>`;
                    }
                }
            }
            
            if (allSatisfied) {
                missingHtml += "<li style='color: #27ae60; font-weight: bold;'>ğŸ‰ æ‰€æœ‰ç›®æ¨™éƒ½å·²é”æˆï¼</li>";
            } else {
                missingHtml += `<li style='color: #e74c3c; font-weight: bold;'>âš ï¸ ç¸½å…±é‚„éœ€è¦åˆ·å– ${totalMissing} å€‹ç´ æ</li>`;
            }
            
            missingHtml += "</ul>";
            
            elements.simulationResult.innerHTML = resultHtml + missingHtml;
            
            // æ›´æ–°æ¨¡æ“¬è¡¨æ ¼
            let tableHtml = "";
            for (const color of config.colorOrder) {
                const before = current[color];
                const after = strategy.final[color];
                const target = config.requirements[color];
                
                let operation = "ç„¡æ“ä½œ";
                if (color === "green" && strategy.synthesize.green > 0) {
                    operation = `åˆæˆ ${strategy.synthesize.green} æ¬¡ (-${strategy.synthesize.green * 3})`;
                } else if (color === "blue") {
                    let change = 0;
                    if (strategy.synthesize.green > 0) change += strategy.synthesize.green;
                    if (strategy.synthesize.blue > 0) change -= strategy.synthesize.blue * 3;
                    if (change !== 0) {
                        operation = `${change > 0 ? '+' : ''}${change}`;
                    }
                } else if (color === "purple") {
                    let change = 0;
                    if (strategy.synthesize.blue > 0) change += strategy.synthesize.blue;
                    if (strategy.synthesize.purple > 0) change -= strategy.synthesize.purple * 3;
                    if (change !== 0) {
                        operation = `${change > 0 ? '+' : ''}${change}`;
                    }
                } else if (color === "gold" && strategy.synthesize.purple > 0) {
                    operation = `+${strategy.synthesize.purple}`;
                }
                
                let comparison = "";
                if (after >= target) {
                    const surplus = after - target;
                    comparison = surplus === 0 ? "ğŸ¯ å®Œç¾é”æ¨™" : `âœ… é”æ¨™ (+${surplus})`;
                } else {
                    comparison = `âŒ ä¸è¶³ (-${target - after})`;
                }
                
                tableHtml += `
                <tr>
                    <td class="${color}">${config.icons[color]} ${config.colors[color]}è‰²</td>
                    <td>${before}</td>
                    <td class="${operation !== "ç„¡æ“ä½œ" ? "blue" : "gray"}">${operation}</td>
                    <td class="${after >= target ? "green" : "red"}">${after}</td>
                    <td class="${after >= target ? "green" : "red"}">${comparison}</td>
                </tr>`;
            }
            
            elements.simulationTable.innerHTML = tableHtml;
        }
        
        function copyResults() {
            const current = {};
            for (const color of config.colorOrder) {
                current[color] = parseInt(elements.currents[color].value) || 0;
            }
            
            const strategy = calculateOptimalStrategy(current);
            
            let result = "=== ğŸ® æ™ºæ…§ç´ æéœ€æ±‚åˆ†æå ±å‘Š ===\n\n";
            result += "ğŸ“… ç”Ÿæˆæ™‚é–“: " + new Date().toLocaleString() + "\n\n";
            
            // 1. ç›®æ¨™éœ€æ±‚
            result += "ğŸ¯ ç›®æ¨™éœ€æ±‚:\n";
            for (const color of config.colorOrder) {
                result += `- ${config.colors[color]}è‰²: ${config.requirements[color]} å€‹\n`;
            }
            
            // 2. ç•¶å‰æŒæœ‰
            result += "\nğŸ“¦ ç•¶å‰æŒæœ‰:\n";
            for (const color of config.colorOrder) {
                result += `- ${config.colors[color]}è‰²: ${current[color]} å€‹\n`;
            }
            
            // 3. æœ€ä½³åˆæˆç­–ç•¥
            result += "\nğŸ§  æœ€ä½³åˆæˆç­–ç•¥:\n";
            if (strategy.synthesize.green > 0) {
                result += `- ç¶ è‰²åˆæˆ: ${strategy.synthesize.green} æ¬¡ (æ¶ˆè€— ${strategy.synthesize.green * 3} å€‹ç¶ è‰² â†’ ç²å¾— ${strategy.synthesize.green} å€‹è—è‰²)\n`;
            }
            if (strategy.synthesize.blue > 0) {
                result += `- è—è‰²åˆæˆ: ${strategy.synthesize.blue} æ¬¡ (æ¶ˆè€— ${strategy.synthesize.blue * 3} å€‹è—è‰² â†’ ç²å¾— ${strategy.synthesize.blue} å€‹ç´«è‰²)\n`;
            }
            if (strategy.synthesize.purple > 0) {
                result += `- ç´«è‰²åˆæˆ: ${strategy.synthesize.purple} æ¬¡ (æ¶ˆè€— ${strategy.synthesize.purple * 3} å€‹ç´«è‰² â†’ ç²å¾— ${strategy.synthesize.purple} å€‹é‡‘è‰²)\n`;
            }
            
            if (strategy.synthesize.green === 0 && strategy.synthesize.blue === 0 && strategy.synthesize.purple === 0) {
                result += "- ç„¡éœ€åˆæˆï¼Œç•¶å‰è³‡æºå·²ç¶“æœ€å„ªé…ç½®\n";
            }
            
            // 4. åŸ·è¡Œå¾Œçµæœ
            result += "\nğŸ”„ åŸ·è¡Œå¾Œæ•¸é‡:\n";
            for (const color of config.colorOrder) {
                const final = strategy.final[color];
                const target = config.requirements[color];
                const status = final >= target ? "âœ“ é”æ¨™" : "âœ— ä¸è¶³";
                const diff = final - target;
                result += `- ${config.colors[color]}è‰²: ${final} å€‹ (${status}${diff !== 0 ? `, ${diff > 0 ? '+' : ''}${diff}` : ''})\n`;
            }
            
            // 5. æœ€çµ‚åˆ·å–å»ºè­°
            result += "\nğŸ’¡ æœ€çµ‚åˆ·å–å»ºè­°:\n";
            let totalNeed = 0;
            let hasNeed = false;
            
            for (const color of config.colorOrder) {
                const final = strategy.final[color];
                const target = config.requirements[color];
                const missing = Math.max(0, target - final);
                
                if (missing > 0) {
                    hasNeed = true;
                    totalNeed += missing;
                    result += `- é‚„éœ€åˆ·å– ${config.colors[color]}è‰²: ${missing} å€‹\n`;
                }
            }
            
            if (!hasNeed) {
                result += "- ğŸ‰ æ‰€æœ‰ç´ æéƒ½å·²é”æ¨™ï¼Œç„¡éœ€é¡å¤–åˆ·å–ï¼\n";
            } else {
                result += `\nâš ï¸ ç¸½è¨ˆéœ€è¦åˆ·å–: ${totalNeed} å€‹ç´ æ\n`;
            }
            
            // 6. æ•ˆç‡åˆ†æ
            result += "\nğŸ“ˆ æ•ˆç‡åˆ†æ:\n";
            const totalWaste = strategy.waste.green + strategy.waste.blue + strategy.waste.purple + strategy.waste.gold;
            if (totalWaste > 0) {
                result += `- é è¨ˆå‰©é¤˜ç´ æ: ${totalWaste} å€‹\n`;
                for (const color of config.colorOrder) {
                    if (strategy.waste[color] > 0) {
                        result += `  â€¢ ${config.colors[color]}è‰²å‰©é¤˜: ${strategy.waste[color]} å€‹\n`;
                    }
                }
            } else {
                result += "- âœ¨ å®Œç¾é…ç½®ï¼Œç„¡æµªè²»ç´ æ\n";
            }
            
            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(result)
                .then(() => alert("ğŸ“‹ åˆ†æå ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼"))
                .catch(err => {
                    console.error("è¤‡è£½å¤±æ•—:", err);
                    // é™ç´šæ–¹æ¡ˆ
                    const textarea = document.createElement("textarea");
                    textarea.value = result;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand("copy");
                    document.body.removeChild(textarea);
                    alert("ğŸ“‹ åˆ†æå ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
                });
        }
        
        function showAbout() {
            const about = `ğŸ® æ™ºæ…§ç´ æéœ€æ±‚è¨ˆç®—å™¨ v3.0

âœ¨ æ ¸å¿ƒåŠŸèƒ½:
â€¢ é€†å‘è¨ˆç®—æœ€ä½³åˆæˆç­–ç•¥ï¼Œé¿å…è³‡æºæµªè²»
â€¢ æ™ºæ…§åˆ†æç•¶å‰ç´ æé…ç½®
â€¢ ç²¾ç¢ºè¨ˆç®—æœ€çµ‚åˆ·å–éœ€æ±‚
â€¢ å¯¦æ™‚æ¨¡æ“¬åˆæˆçµæœ

ğŸ”§ åˆæˆè¦å‰‡:
â€¢ 3å€‹ç¶ è‰² â†’ 1å€‹è—è‰²
â€¢ 3å€‹è—è‰² â†’ 1å€‹ç´«è‰²  
â€¢ 3å€‹ç´«è‰² â†’ 1å€‹é‡‘è‰²
â€¢ åˆæˆä¸å¯é€†ï¼Œéœ€è¦è¬¹æ…è¦åŠƒ

ğŸ“‹ ä½¿ç”¨æ­¥é©Ÿ:
1. è¨­å®šå„è‰²ç´ æçš„ç›®æ¨™éœ€æ±‚æ•¸é‡
2. è¼¸å…¥ç•¶å‰æŒæœ‰çš„ç´ ææ•¸é‡
3. æŸ¥çœ‹é€†å‘åˆ†æçš„æœ€ä½³ç­–ç•¥
4. åƒè€ƒæ¨¡æ“¬åŸ·è¡Œçµæœé€²è¡Œåˆæˆ
5. æŒ‰ç…§æœ€çµ‚å»ºè­°é€²è¡Œç´ ææ”¶é›†

ğŸ¯ ç®—æ³•ç‰¹è‰²:
â€¢ å¾ç›®æ¨™éœ€æ±‚é€†å‘æ¨ç®—å¯¦éš›éœ€è¦é‡
â€¢ å„ªå…ˆæ»¿è¶³é«˜ç­‰ç´šç´ æéœ€æ±‚
â€¢ æœ€å°åŒ–è³‡æºæµªè²»
â€¢ æä¾›å®Œæ•´çš„åŸ·è¡Œè·¯å¾‘

ğŸ’¡ ä½¿ç”¨æŠ€å·§:
â€¢ å»ºè­°å…ˆæŒ‰ç…§é€†å‘åˆ†æé€²è¡Œåˆæˆ
â€¢ æ³¨æ„ä¿ç•™è¶³å¤ çš„ç›®æ¨™ç´ ææ•¸é‡
â€¢ åˆæˆå‰è«‹ä»”ç´°ç¢ºèªç­–ç•¥
â€¢ å¯éš¨æ™‚èª¿æ•´ç›®æ¨™éœ€æ±‚é‡æ–°è¨ˆç®—

ğŸ¨ ä»‹é¢èªªæ˜:
ğŸŸ¢ ç¶ è‰²: è¶³å¤ /é”æ¨™ç‹€æ…‹
ğŸ”´ ç´…è‰²: ä¸è¶³/éœ€è¦é—œæ³¨
ğŸ”µ è—è‰²: åˆæˆç›¸é—œæ“ä½œ
âšª ç°è‰²: ç„¡éœ€æ“ä½œ`;
            
            alert(about);
        }
        
        // å•Ÿå‹•æ‡‰ç”¨
        init();
    </script>
</body>
</html>
